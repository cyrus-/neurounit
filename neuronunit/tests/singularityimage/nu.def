# Bootstrap definition example neuronunit
# overlay

%setup
    echo "Looking in directory '$SINGULARITY_ROOTFS' for /bin/sh"
    if [ ! -x "$SINGULARITY_ROOTFS/bin/sh" ]; then
        echo "Hrmm, this container does not have /bin/sh installed..."
        exit 1
    fi
    
    if [ ! -d "git" ]; then
        mkdir git
        cd git
        git clone -b dev https://github.com/russelljjarvis/neuronunit.git
       
        git clone -b dev https://github.com/scidash/sciunit.git
        cd sciunit
        /opt/conda/bin/python setup.py install 
        echo "deleting nunit"
        #rm -r /neuronunit
    fi
    export PATH="$PATH:/home/jovyan/nrn-7.4/x86_64/bin/nrnivmodl:/home/jovyan/nrn-7.4/x86_64/bin"
    ls /home/jovyan/nrn-7.4/x86_64/bin
    echo $PATH
    export PATH="$PATH:/opt/conda/bin/python"
    export PYTHONPATH="$PYTHONPATH:/home/jovyan"
    apt-get install libncurses5-dev libreadline-dev
    apt-get update


%post


    cd /git/sciunit
    /opt/conda/bin/python setup.py install 
    cd /git/neuronunit/neuronunit/tests/NeuroML2
    bash /home/jovyan/nrn-7.4/x86_64/bin/nrnivmodl
    cd /git/neuronunit/neuronunit/tests
    /opt/conda/bin/python -m scoop nsga.py 
    exit 0

 
%runscript
    exec /bin/bash
    exec su jovyan
    exec cd /home/jovyan/neuronunit/neuronunit/tests
    exec ls *.py
    exec echo `pwd`
    
    exec /opt/conda/bin/python -m scoop nsga.py 
    

	#echo "Arguments received: $*"
	#exec /bin/bash
	#exec /usr/bin/python "$@"

%test
    exec /bin/bash
    exec su jovyan
    exec cd /home/jovyan/neuronunit/neuronunit/tests
    exec ls *.py
    exec echo `pwd`
    
    exec /opt/conda/bin/python -m scoop nsga.py 


#	/usr/local/bin/mpirun --allow-run-as-root /usr/bin/mpi_ring
